import static cucumber.api.groovy.EN.*
import cucumber.api.PendingException
//import org.apache.ivy.core.report.*

//import static groovyx.net.http.ContentType.JSON

//import groovyx.net.http.RESTClient
import groovyx.net.http.HTTPBuilder
import groovyx.net.http.ContentType.*
import static groovyx.net.http.Method.*
//import org.apache.http.HttpResponse
//import groovy.util.slurpersupport.GPathResult
//import static groovyx.net.http.ContentType.URLENC

//import org.apache.http.client.methods.*
//import org.apache.http.entity.*
//import org.apache.http.impl.client.*
//import org.apache.http.HttpRequestInterceptor 
//import org.apache.http.protocol.HttpContext 
//import org.apache.http.HttpRequest 

 Given(~/^I am an authenticated user$/) { ->
	String username = "PhilNorman2"
	String password = "Allie100"
//RESTClient github = new RESTClient( 'https://api.github.com')
def github = new HTTPBuilder( 'https://api.github.com')
//def github = new HTTPBuilder( 'https://api.facebook.com')

//RESTClient github = new RESTClient( 'http://google.com')
//RESTClient github = new RESTClient( 'https://api.facebook.com')

//github.headers['Authorization'] = 'Basic '+"PhilNorman2:Allie100".getBytes('iso-8859-1').encodeBase64()

//github.client.addRequestInterceptor(new HttpRequestInterceptor() {
//    void process(HttpRequest httpRequest, HttpContext httpContext) {
//        httpRequest.addHeader('Authorization', 'Basic' + 'PhilNorman2:Allie100'.bytes.encodeBase64().toString())
//    }
//})

//github.setHeaders([Authorization: "Basic UGhpbE5vcm1hbjI6QWxsaWUxMDA="])
String credentials = "${username}:${password}".getBytes('iso-8859-1').encodeBase64()
println "credentials: " + credentials
github.setHeaders([Authorization: "Basic " + credentials])
github.setHeaders([Content-Type: "application/json")]
//github.auth.basic(username, password)

println 'calling GET'
try {
def response = github.get(
	path: '/'
	){ resp, reader ->
    println "response status: ${resp.statusLine}"     
    println 'Response data: -----'     
    System.out << reader     
    println '\n--------------------'   
    } 
    println 'get succeeded'
} catch (groovyx.net.http.HttpResponseException ex) {
    println 'badResponse==' + ex.response.getStatus()//404
    println  ex.response.data.toString()
    //println 'response body==' + ex.response.contentAsString //or for raw bytes[] use ex.response.data
}

//	def client = new RESTClient( 'http://www.acme.com/' )
//	def resp = client.get( path : 'products/3322' ) // ACME boomerang
//
//	assert resp.status == 200  // HTTP response code; 404 means not found, etc.
//	println resp.getData()

    }

    When(~/^I create the "([^"]*)" repository$/) { String arg1 ->
        // Write code here that turns the phrase above into concrete actions
        throw new PendingException()
    }

    When(~/^I request a list of my repositories$/) { ->
        // Write code here that turns the phrase above into concrete actions
        throw new PendingException()
    }

    Then(~/^The results should include a repository name "([^"]*)"$/) { String arg1 ->
        // Write code here that turns the phrase above into concrete actions
        throw new PendingException()
    }

